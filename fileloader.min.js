!function(){"use strict";var t,e=document.getElementsByTagName("head")[0],o={timeout:{code:"101",message:"Timeout reached"},maxAttempt:{code:"102",message:"Maximum file upload reached"},noItems:{code:"103",message:"Add at least one item to load"}},i=function(){};function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})}i.prototype.constructor=i,i.prototype.load=function(e){if(t=0,!e.files)throw new Error("("+o.noItems.code+") "+o.noItems.message);this.settings=e,this.files=e.files,this.maxFiles=this.files.length-1,this.timeout=e.timeout?e.timeout:1e4,this.maxAttemptLoad=e.maxAttemptLoad?e.maxAttemptLoad:5,this.attemptLoad=0,this.timerCount=0,this.ignoreErrorLoading=!!e.ignoreErrorLoading&&e.ignoreErrorLoading,this.settings.debug&&(this.debug=!0),this.initTimer(),this.loadItem()},i.prototype.initTimer=function(){var t=this;this.timer=setInterval(function(){if(t.timerCount++,t.log("(Fileload) timer running : "+t.timerCount),t.timerCount>=t.timeout)return t.settings.onError({code:o.timeout,response:{}}),t.stopTimer(),!1},1e3)},i.prototype.stopTimer=function(){clearInterval(this.timer),this.timerCount=0,this.timer=null},i.prototype.loadItem=function(){var e=this.files[t],o=e.file;switch(o.split(".").pop()){case"js":this.checkScript(e);break;case"css":this.loadCss(e);break;default:this.log("Item cannot be loaded: "+o),this.loadNextFile()}},i.prototype.loadCss=function(i){var n=r(),s=i.file,a=document.createElement("link"),d=this;a.rel="stylesheet",a.type="text/css",a.id=n,a.href=s,d.log("Loading style: "+s),a.onload=function(){d.log('Loaded style "'+s+'".'),d.settings.onLoaded&&d.settings.onLoaded({id:n,item:i,index:t}),d.loadNextFile()},a.onerror=function(){d.log('Error loading style "'+s+'".'),document.getElementById(n).remove(),d.attemptLoad<this.maxAttemptLoad?(d.attemptLoad++,d.loadCss(i)):(d.attemptLoad=0,d.settings.onError&&(d.ignoreErrorLoading?d.loadNextFile():(d.stopTimer(),d.settings.onError({code:o.maxAttempt,response:i}))))},e.appendChild(a)},i.prototype.checkScript=function(t){var e=t.module;e&&window[e]?(this.log(e+" already exists!"),this.loadNextFile()):this.loadScript(t)},i.prototype.loadScript=function(i){var n=this;if(!n.timer)return!1;var s=i.file,a=document.createElement("script"),d=r();a.type="text/javascript",a.src=s,a.id=d,a.onload=function(){n.log('Loaded script "'+s+'".'),n.settings.onLoaded&&n.settings.onLoaded({id:d,item:i,index:t}),n.loadNextFile()},a.onerror=function(){n.log('Error loading script "'+s+'".'),document.getElementById(d).remove(),n.attemptLoad<n.maxAttemptLoad?(n.attemptLoad++,n.loadScript(i)):(n.attemptLoad=0,n.settings.onError&&(n.ignoreErrorLoading?n.loadNextFile():(n.stopTimer(),n.settings.onError({code:o.maxAttempt,response:i}))))},n.log('Loading script "'+s+'".'),e.appendChild(a)},i.prototype.loadNextFile=function(){t<this.maxFiles?(t++,this.loadItem()):(this.stopTimer(),this.settings.onComplete())},i.prototype.log=function(t){this.debug&&console.log(t)},window.FileLoader=i}();
